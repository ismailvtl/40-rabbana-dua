<!DOCTYPE html>
<html lang="en" translate="no">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>40 Rabbana Dua</title>
    <link rel="manifest" href="manifest.json">
    <meta name="description" content="40 Rabbana Du'as from the Quaran">
    <meta name="keywords" content="40 rabbana dua, islamic dua, duas in quran, rabbana dua, 40 duas in quaran">
    <link rel="icon" href="rabbana.png" type="image/png" />
    <link rel="apple-touch-icon" href="rabbana.png">
    <meta name="theme-color" content="white" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="40 Rabbana Dua">
    <meta name="msapplication-TileImage" content="rabbana.png">
    <meta name="msapplication-TileColor" content="#01675F">
    <link rel="stylesheet" href="style.css?v=5">

     <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6C4EBSR56J"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-6C4EBSR56J');
</script>
</head>

<body>
    <div class="dua-container">
        <header>
            <div class="title">
                <span>40 Rabbana Du'as </span><span class="small-text">from the Qur'an</span>
            </div>
            <div class="actions">
                <button class="dots"><svg width="4" height="16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="2" cy="2" r="2" fill="#444"></circle>
                        <circle cx="2" cy="8" r="2" fill="#444"></circle>
                        <circle cx="2" cy="14" r="2" fill="#444"></circle>
                    </svg></button>

                <div class="options">
                    <ul>
                        <li><button id="enableTranslation"><span>Translation: <span
                                        class="themeText">OFF</span></span></button></li>
                        <li><button id="enableTransliteration"><span>Transliteration: <span
                                        class="themeText">OFF</span></span></button></li>
                        <li style="border-top: 1px solid #ececec;"><a rel="noreferrer" class="whatsapp-cta"
                                href="https://api.whatsapp.com/send?phone=971561316849" target="_blank"><span>Contact /
                                    Feedback</span></a></li>
                    </ul>
                </div>
            </div>
            <div class="scroll-progress">
                <span><span>
            </div>
        </header>
        <main>
            <div class="dua-list">

            </div>
        </main>
        <footer>
            <div class="audio-player">
                <audio id="audioEl" controls>
                    <source src="40-Rabbana.mp3" type="audio/mpeg">
                </audio>
            </div>
        </footer>
        <section class="overlay" style="display: none;"></section>
    </div>

    <script>
        let duaContainer = document.querySelector('.dua-list');

        const xhr = new XMLHttpRequest();
        xhr.open("GET", "data.json");
        xhr.onload = () => {
            if (xhr.status === 200) {
                const data = JSON.parse(xhr.responseText);
                // Do something with the data here
                for (const [index,dua] of data.entries()) {
                    duaContainer.innerHTML += `<div data-num="${index+1}" class="dua-list-item">
                <div class="dua-list-item-quran-reference">${dua.refno}</div>
                         <div class="dua-list-item-arabic"><span>${dua.arabic}</span></div>
                         <div class="dua-list-item-transliteration">${dua.transliteration}</div>
                         <div class="dua-list-item-translation">${dua.translation}</div>
                     </div>`
                }
            } else {
                console.error("Failed to load data.json");
            }
        };
        xhr.send();


        document.addEventListener('DOMContentLoaded', () => {
            let scrollPositions = null;
            setTimeout(function () {
                scrollPositions = [
                    {
                        start: 0,
                        end: 7,
                        element: document.querySelectorAll('.dua-list-item')[0]
                    },
                    {
                        start: 7,
                        end: 22,
                        element: document.querySelectorAll('.dua-list-item')[1]
                    },
                    {
                        start: 22,
                        end: 32,
                        element: document.querySelectorAll('.dua-list-item')[2]
                    },
                    {
                        start: 32,
                        end: 43,
                        element: document.querySelectorAll('.dua-list-item')[3]
                    },
                    {
                        start: 43,
                        end: 50,
                        element: document.querySelectorAll('.dua-list-item')[4]
                    },
                    {
                        start: 50,
                        end: 59,
                        element: document.querySelectorAll('.dua-list-item')[5]
                    },
                    {
                        start: 59,
                        end: 71,
                        element: document.querySelectorAll('.dua-list-item')[6]
                    },
                    {
                        start: 71,
                        end: 81,
                        element: document.querySelectorAll('.dua-list-item')[7]
                    },
                    {
                        start: 81,
                        end: 90,
                        element: document.querySelectorAll('.dua-list-item')[8]
                    },
                    {
                        start: 90,
                        end: 100,
                        element: document.querySelectorAll('.dua-list-item')[9]
                    },
                    {
                        start: 100,
                        end: 110,
                        element: document.querySelectorAll('.dua-list-item')[10]
                    },
                    {
                        start: 111,
                        end: 120,
                        element: document.querySelectorAll('.dua-list-item')[11]
                    },
                    {
                        start: 121,
                        end: 129,
                        element: document.querySelectorAll('.dua-list-item')[12]
                    },
                    {
                        start: 129,
                        end: 138,
                        element: document.querySelectorAll('.dua-list-item')[13]
                    },
                    {
                        start: 139,
                        end: 151,
                        element: document.querySelectorAll('.dua-list-item')[14]
                    },
                    {
                        start: 151,
                        end: 158,
                        element: document.querySelectorAll('.dua-list-item')[15]
                    },
                    {
                        start: 158,
                        end: 167,
                        element: document.querySelectorAll('.dua-list-item')[16]
                    },
                    {
                        start: 167,
                        end: 174,
                        element: document.querySelectorAll('.dua-list-item')[17]
                    },
                    {
                        start: 174,
                        end: 193,
                        element: document.querySelectorAll('.dua-list-item')[18]
                    },
                    {
                        start: 193,
                        end: 204,
                        element: document.querySelectorAll('.dua-list-item')[19]
                    },
                    {
                        start: 205,
                        end: 209,
                        element: document.querySelectorAll('.dua-list-item')[20]
                    },
                    {
                        start: 209,
                        end: 215,
                        element: document.querySelectorAll('.dua-list-item')[21]
                    },
                    {
                        start: 216,
                        end: 222,
                        element: document.querySelectorAll('.dua-list-item')[22]
                    },
                    {
                        start: 222,
                        end: 230,
                        element: document.querySelectorAll('.dua-list-item')[23]
                    },
                    {
                        start: 231,
                        end: 241,
                        element: document.querySelectorAll('.dua-list-item')[24]
                    },
                    {
                        start: 242,
                        end: 248,
                        element: document.querySelectorAll('.dua-list-item')[25]
                    },
                    {
                        start: 249,
                        end: 254,
                        element: document.querySelectorAll('.dua-list-item')[26]
                    },
                    {
                        start: 255,
                        end: 262,
                        element: document.querySelectorAll('.dua-list-item')[27]
                    },
                    {
                        start: 263,
                        end: 270,
                        element: document.querySelectorAll('.dua-list-item')[28]
                    },
                    {
                        start: 271,
                        end: 278,
                        element: document.querySelectorAll('.dua-list-item')[29]
                    },
                    {
                        start: 279,
                        end: 291,
                        element: document.querySelectorAll('.dua-list-item')[30]
                    },
                    {
                        start: 292,
                        end: 301,
                        element: document.querySelectorAll('.dua-list-item')[31]
                    },
                    {
                        start: 302,
                        end: 306,
                        element: document.querySelectorAll('.dua-list-item')[32]
                    },
                    {
                        start: 307,
                        end: 317,
                        element: document.querySelectorAll('.dua-list-item')[33]
                    },
                    {
                        start: 318,
                        end: 343,
                        element: document.querySelectorAll('.dua-list-item')[34]
                    },
                    {
                        start: 344,
                        end: 353,
                        element: document.querySelectorAll('.dua-list-item')[35]
                    },
                    {
                        start: 354,
                        end: 359,
                        element: document.querySelectorAll('.dua-list-item')[36]
                    },
                    {
                        start: 360,
                        end: 365,
                        element: document.querySelectorAll('.dua-list-item')[37]
                    },
                    {
                        start: 366,
                        end: 376,
                        element: document.querySelectorAll('.dua-list-item')[38]
                    },
                    {
                        start: 377,
                        end: 390,
                        element: document.querySelectorAll('.dua-list-item')[39]
                    }
                ];
            }, 500)


            audioEl.addEventListener('timeupdate', () => {
                const currentTime = audioEl.currentTime / audioEl.playbackRate;
                for (const scrollPosition of scrollPositions) {
                    if (currentTime >= scrollPosition.start && currentTime < scrollPosition.end) {
                        const element = scrollPosition.element;
                        if (element) {
                            const position = element.getBoundingClientRect()?.top + window.scrollY;
                            if (position !== undefined) {
                                clearAllHighlight();
                                element.scrollIntoView({ block: "center", behavior: "smooth" })
                                element.classList.add('highlight-item');
                                break;
                            }
                        }
                    }
                }
            });

        });

        var audioEl = document.getElementById("audioEl");
        audioEl.playbackRate = 1.5;
        audioEl.controlsList = "noplaybackrate";
        let overLay = document.querySelector('.overlay');

        document.querySelector('.dots').addEventListener('click', function () {
            document.querySelector('body').classList.add('options-opened');
            overLay.style.display = "block";
        });

        overLay.addEventListener('click', function () {
            overLay.style.display = "none";
            document.querySelector('body').classList.remove('options-opened');
        });

        //enable translation
        document.querySelector('#enableTranslation').addEventListener('click', function () {
            toggleTranslation();
        });

        function checkTranslationLocalStorage() {
            if (localStorage.getItem("rabbanaDuaTranslation") != null && localStorage.getItem("rabbanaDuaTranslation") === 'ON') {
                document.querySelector('#enableTranslation .themeText').textContent = "ON";
                document.querySelector('.dua-list').classList.add('translations-enabled');
            } else {
                document.querySelector('#enableTranslation .themeText').textContent = "OFF";
                document.querySelector('.dua-list').classList.remove('translations-enabled');
            }
        }

        function checkTransliterationLocalStorage() {
            if (localStorage.getItem("rabbanaDuaTransliteration") != null && localStorage.getItem("rabbanaDuaTransliteration") === 'ON') {
                document.querySelector('#enableTransliteration .themeText').textContent = "ON";
                document.querySelector('.dua-list').classList.add('transliteration-enabled');
            } else {
                document.querySelector('#enableTransliteration .themeText').textContent = "OFF";
                document.querySelector('.dua-list').classList.remove('transliteration-enabled');
            }
        }

        function toggleTranslation() {
            if (localStorage.getItem("rabbanaDuaTranslation") != null && localStorage.getItem("rabbanaDuaTranslation") === 'ON') {
                localStorage.setItem("rabbanaDuaTranslation", "OFF");
                document.querySelector('#enableTranslation .themeText').textContent = "OFF";
                document.querySelector('.dua-list').classList.remove('translations-enabled');
            } else {
                localStorage.setItem("rabbanaDuaTranslation", "ON");
                document.querySelector('#enableTranslation .themeText').textContent = "ON";
                document.querySelector('.dua-list').classList.add('translations-enabled');
            }
        }

        function toggleTransliteration() {
            if (localStorage.getItem("rabbanaDuaTransliteration") != null && localStorage.getItem("rabbanaDuaTransliteration") === 'ON') {
                localStorage.setItem("rabbanaDuaTransliteration", "OFF");
                document.querySelector('#enableTransliteration .themeText').textContent = "OFF";
                document.querySelector('.dua-list').classList.remove('transliteration-enabled');
            } else {
                localStorage.setItem("rabbanaDuaTransliteration", "ON");
                document.querySelector('#enableTransliteration .themeText').textContent = "ON";
                document.querySelector('.dua-list').classList.add('transliteration-enabled');
            }
        }


        document.querySelector('#enableTransliteration').addEventListener('click', function () {
            toggleTransliteration();
        });

        checkTranslationLocalStorage();
        checkTransliterationLocalStorage();

        function clearAllHighlight() {
            document.querySelectorAll('.dua-list-item').forEach(function (item) {
                item.classList.remove('highlight-item');
            })
        }

        function scrollPercentage() {
            return (
                (document.querySelector('main').scrollTop + document.body.scrollTop) /
                (document.querySelector('main').scrollHeight -
                    document.querySelector('main').clientHeight) *
                100
            );
        }

        document.querySelector('main').addEventListener("scroll", function () {
            let s = scrollPercentage();
            document.querySelector(".scroll-progress span").style.width = `${s}%`;
        });


    </script>
</body>

</html>
